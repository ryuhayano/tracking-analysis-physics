<!--
  Physics Exam Lab - Tracking Analysis Software
  Copyright (c) 2025 一般社団法人 国際物理オリンピック2023記念協会
  Licensed under the Creative Commons BY-NC 4.0 International License.
  See https://creativecommons.org/licenses/by-nc/4.0/
-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tracking Analysis for Physics</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-container">
    <div class="control-panel">
      <span class="app-title"><img src="assets/images/logo.png" class="app-logo" alt="Logo"> Tracking Analysis for Physics</span>
      <div class="file-input-section">
        <div class="file-input-row">
          <label for="videoInput" class="file-input-label">動画ファイル選択</label>
          <input type="file" id="videoInput" accept="video/*,.mov,.mp4,.avi,.webm,.mkv,video/quicktime,video/mp4">
          <div class="file-name-display" id="fileNameDisplay"></div>
        </div>
        <div class="file-input-row">
          <button id="loadSampleVideo" type="button">サンプル動画</button>
          <a href="USAGE_GUIDE.html" target="_blank" class="guide-link">
            <span>❓</span> 使い方ガイド
          </a>
        </div>
      </div>
      <div class="control-grid">
        <div class="control-section">
          <button id="setOriginBtn">原点設定</button>
          <button id="setScaleBtn">スケール設定</button>
          <button id="startTrackingBtn">追跡開始</button>
        </div>
        <div class="control-section">
          <label for="objectCountSelect">物体数</label>
          <select id="objectCountSelect">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
          <label for="frameIntervalSelect">フレーム間隔</label>
          <select id="frameIntervalSelect">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
        </div>
        <div class="control-section">
          <button id="playBtn">▶再生</button>
          <button id="pauseBtn">■停止</button>
          <button id="prevFrameBtn">⏪戻る</button>
          <button id="nextFrameBtn">⏩進む</button>
        </div>
        <div class="control-section frame-controls">
          <div class="frame-label">フレーム設定</div>
          <label>FPS: <input type="text" id="fpsInput" value="30"></label>
          <div class="frame-range">
            <label>開始: <input type="text" id="startFrameInput"></label>
            <label>終了: <input type="text" id="endFrameInput"></label>
            <span id="currentFrameLabel" class="current-frame">現在フレーム: 0</span>
          </div>
        </div>
        <div class="control-section">
          <button id="undoBtn" style="display:none;">Undo</button>
        </div>
        <div class="control-section data-output-section">
          <button id="exportCsvBtn">データ出力</button>
          <button id="resetBtn">全リセット</button>
        </div>
      </div>
      <div class="quick-guide">
        <div class="guide-step">
          <span class="step-number">1</span>
          <span class="step-text">ファイル選択</span>
        </div>
        <div class="guide-step">
          <span class="step-number">2</span>
          <span class="step-text">原点設定</span>
        </div>
        <div class="guide-step">
          <span class="step-number">3</span>
          <span class="step-text">スケール設定</span>
        </div>
        <div class="guide-step">
          <span class="step-number">4</span>
          <span class="step-text">追跡開始（間隔設定）</span>
        </div>
        <div class="guide-step">
          <span class="step-number">5</span>
          <span class="step-text">データ出力</span>
        </div>
      </div>
    </div>
    <div class="video-container">
      <video id="video" width="640" height="480" controls style="display:none;"></video>
      <canvas id="videoCanvas" width="640" height="480"></canvas>
      <input type="range" id="frameSlider" min="0" max="100" value="0" step="1">
    </div>
  </div>
  <div class="license-info">
    © 2025 一般社団法人 国際物理オリンピック2023記念協会 – CC BY-NC 4.0
  </div>
  <script src="main.js"></script>
  <script>
document.getElementById('loadSampleVideo').onclick = function() {
  const video = document.getElementById('video');
  video.src = 'assets/videos/5cups.mov';
  video.load();
  
  // サンプル動画フラグを設定（FPS入力ダイアログをスキップするため）
  window.isSampleVideo = true;
  
  // サンプル動画のファイル名を表示
  const fileNameDisplay = document.getElementById('fileNameDisplay');
  fileNameDisplay.textContent = '5cups.mov (120fps)';
  
  // FPS入力欄を120に設定
  const fpsInput = document.getElementById('fpsInput');
  if (fpsInput) {
    fpsInput.value = '120';
  }
  
  // クイックガイドのステップを更新
  updateQuickGuideStep(2);
  
  // 新しいファイル読み込み時にリセット処理を実行（ファイル選択時と同じ処理）
  // 追跡データをクリア
  if (typeof trackingData !== 'undefined') {
    trackingData = [];
  }
  // スケール・原点設定をクリア
  if (typeof scalePoints !== 'undefined') {
    scalePoints = [];
  }
  if (typeof originPoint !== 'undefined') {
    originPoint = null;
  }
  if (typeof scaleLength !== 'undefined') {
    scaleLength = null;
  }
  // 追跡モードを終了
  if (typeof trackingMode !== 'undefined' && trackingMode) {
    if (typeof endTrackingMode === 'function') {
      endTrackingMode();
    }
  }
  // 設定モードをクリア
  if (typeof mode !== 'undefined') {
    mode = null;
  }
  if (typeof updateGuideText === 'function') {
    updateGuideText('');
  }
  if (typeof disableVideoControls === 'function') {
    disableVideoControls(false);
  }
  // ボタンのハイライトを解除
  const setScaleBtn = document.getElementById('setScaleBtn');
  const setOriginBtn = document.getElementById('setOriginBtn');
  if (setScaleBtn) setScaleBtn.style.background = '';
  if (setOriginBtn) setOriginBtn.style.background = '';
  // キャンセルボタンと案内を削除
  const cancelBtn = document.getElementById('cancelBtn');
  if (cancelBtn) cancelBtn.remove();
  const cancelHint = document.getElementById('cancelHint');
  if (cancelHint) cancelHint.remove();
  
  // 動画の読み込みが完了したらリサイズを実行（VideoEventManagerで管理）
  // リサイズ処理はVideoEventManagerのhandleLoadedMetadataで実行される
};
</script>
</body>
</html>


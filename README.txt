【Tracking Analysis for Physics】

---

■ 概要
スマホ等で撮影した動画から、物体の位置と時間を手動で取得し、物理実験や解析に利用できるブラウザベースのトラッキングツールです。

---

■ 主な機能
- 動画ファイルの読み込み（mp4, mov等）
- 原点・スケール（長さ・回転）設定
- フレームレート設定、解析範囲（開始・終了フレーム）指定
- ズーム・ドラッグによる動画拡大・移動
- 手動トラッキング（クリックで物体位置を記録、マーカー表示）
- 記録データのCSV出力（秒単位、ヘッダー付き）
- UIは日本語対応

---

■ 使用方法
1. 「Choose File」で動画ファイルを選択
2. 「原点設定」→canvas上で原点をクリック
3. 「スケール設定」→canvas上で物差しの始点・終点をクリック→長さ(m)を入力
4. フレームレート・解析範囲を必要に応じて設定
5. ズーム（＋−リセット）やドラッグで動画を見やすく調整
6. 「手動追跡モード」ON→物体の位置をクリック（1クリックごとにフレーム進む）
7. 「CSV出力」で記録データをダウンロード

---

■ 実装方法・構成
- index.html：UIとレイアウト
- style.css：デザイン・レイアウト調整
- main.js：全ロジック（動画制御、座標変換、トラッキング、ズーム、CSV出力等）
- 依存ライブラリなし、全てバニラJSで実装

---

■ 今後の拡張ポイント例
- 複数物体の同時トラッキング
- 記録点のやり直し・削除機能
- 自動トラッキング（画像処理）
- 英語UI対応
- 記録データのグラフ表示

---

■ 注意事項
- ブラウザのキャッシュに注意。更新時は「Shift+リロード」推奨
- 動画ファイルはローカルでのみ処理され、サーバー送信なし

---

■ 現状の課題・修正履歴（2025年6月）

- クリックした点と記録される点（赤丸）のズレ（特にX方向）が発生していた。
- canvas上の座標変換（ズーム・オフセット・アスペクト比補正）と、物理座標変換の座標系の不一致が主な原因。
- getCanvasCoordsで「動画描画領域内の座標」に統一し、スケール点・原点・trackingDataも同じ座標系で記録するよう修正。
- 物理座標変換（getPhysicalCoords）・逆変換（physicalToCanvas）・CSV出力のすべてでXとYを入れ替え、画面上の上下が物理Y、左右が物理Xとなるよう修正。
- それでもズレが残る場合は、スケール点・原点の設定順や、描画時の補正ロジックを再確認すること。

■ 座標変換修正（2025年6月30日）
- スケールが鉛直でない場合の座標変換を修正
- getPhysicalCoords関数：回転変換のロジックを整理し、Y軸反転の条件判定を削除
- physicalToCanvas関数：逆変換でXとYの入れ替えを削除し、一貫性を保持
- CSV出力：XとYの入れ替えを削除し、物理座標変換と一貫性を保持
- デバッグ用コンソール出力を追加し、座標変換の精度を確認可能に

■ 座標軸可視化・座標系明確化（2025年6月30日）
- Canvas上に座標軸（X軸：青、Y軸：緑）と目盛りを表示
- スケール設定時のガイドテキストを改善し、始点→終点の方向がX軸の正の方向であることを明示
- 座標軸の方向がユーザーに明確になり、CSV出力との一貫性が向上

■ 今後のTODO
- スケール点・原点の設定時の座標系の一貫性チェック
- 物理座標変換・逆変換のロジックのさらなる精査
- UI上で「X=左右、Y=上下」であることを明示
- コードにデバッグ出力やコメントを追加し、引き継ぎやすくする

---

2024-06-30: 物理座標変換・座標軸・出力・赤点描画の不具合修正
- 物理座標変換・逆変換のロジックを整理し、canvas上の座標軸（X:水平, Y:鉛直）が正しく表示されるよう修正
- trackingDataの出力がX:水平, Y:鉛直（下がマイナス）となるよう修正
- 赤点（トラッキング点）が正しい位置に描画されるよう修正
- X軸・Y軸の目盛りラベルの符号も正しくなるよう修正
- コードの保存・描画時のX/Y入れ替え・符号反転の整合性を徹底

今後のTODO:
- UIに「ヘルプ」ボタンを追加し、簡単な使い方を表示できるようにする
- 将来的にはグラフィカルな説明も検討 